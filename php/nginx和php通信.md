nginx和php通信有两种方式：

- tcp(即监听9000端口)
- unix socket(使用unix domain socket连接套接字.sock)

两种方式的区别是：

- tcp需要经过本地会还驱动，还要申请临时端口和tcp资源。
- socket是unix系统进程间通信，以.sock文件作业socket唯一标识（描述符），需要通信的两个进程引用同一个socket描述符就可简历通道进行通信了。

通信方式的选择：

- 考虑到成本和维护的问题，nginx和fpm进行同机部署时，会使用socket进行通信（nginx和fpm分机部署需要单独给nginx分配机器资源）。

- 考虑到性能问题，nginx和fpm会混布（不部署在同一台机器），这样能够充分发挥nginx的性能。此时会选择tcp进行通信，而一般也不会固定ip，而是监听负载均衡，这样可以使流量更均衡。

  > 为什么会使用tcp进行通信，还有一点是当大量请求并发进入时，socket方式需要进行文件I/O操作，因为连接文件需要先获取文件句柄，获取文件句柄需要现在内存中找到对应的文件句柄地址，大量的连接请求就会请求到的文件句柄的缓存池(buffer)，此时就会发生问题(推测是缓存未更新，而文件地址已变or通过此句柄已无法找到对应文件)。

socket是选择fpm还是cgi：

- cgi是在php原生的协议，apache内置了对应的模块，所以在用apache做服务器的时候，会用cgi.sock
- fpm是实现了fastcgi的程序，fpm管理进程池，针对cgi的管理做了优化，所以现在一般都会使用fpm.sock